<!DOCTYPE html>
{% extends 'globe_templates/base.html' %}
{% load static %}



{% block title_block %}
Upcoming Travels
{% endblock %}

{% block content_block %}
<h2>Upcoming Travels</h2>
<strong><a class="nav-link active" href="{% url 'globe_app:add_upcoming_travel' %}">Add New Location</a></strong>


<!-- Mapbox API (Mapbox.com) -->
<div id="map"></div>

<script>
    mapboxgl.accessToken = 'pk.eyJ1IjoidmFsYm9yZ2pvaGFubmVzZW4iLCJhIjoiY2w1czlxdTg1MDJqMjNpbXIzMmE3Z2ZpMSJ9.KhJK2veJjqe6FZ4YtnKkSw';
    var savedMap = new mapboxgl.Map({
        container: 'map',
        // projection: 'globe',
        style: 'mapbox://styles/mapbox/streets-v11',
        projection: 'naturalEarth',
        zoom: 0.75
    });

    // Search box for locations (countries, cities, addresses etc)
    // let myMap = savedMap.addControl(
    //     new MapboxGeocoder({
    //         accessToken: mapboxgl.accessToken,
    //         mapboxgl: mapboxgl,
    //     })
    // );

    // console.log(myMap);

    // Tags for locations (upcoming travel, travel history, and travel wishlist)
    // const upcoming = new mapboxgl.Marker({ color: 'red' })
    //     .setLngLat([13, 13])
    //     .addTo(map);

    // const history = new mapboxgl.Marker({ rotation: -45 })
    //     .setLngLat([12.554729, 55.70651])
    //     .addTo(map);

    // const wishlist = new mapboxgl.Marker({ color: 'green', rotation: 45 })
    //     .setLngLat([12.65147, 55.608166])
    //     .addTo(map);

    // const marker4 = new mapboxgl.Marker({ color: 'green', rotation: 45 })
    //     .setLngLat([16.65147, 55.608166])
    //     .addTo(map);


    function getLocations() {

        let csrfToken = document.cookie.split('=')[1]; // grab the csrf token from the cookies
        // ajax request to send the coordinates to the backend
        $.ajax({
            type: "GET",
            url: "{% url 'globe_app:get_user_saved_locations' user %}",
            headers: { 'X-CSRFToken': csrfToken },
            // success and error are callbacks. They notify when the request is done.
            success: function (response) {
                console.log(response);
                response.locationList.forEach(element => {
                    new mapboxgl.Marker({ color: 'red' })
                        .setLngLat([element[0], element[1]])
                        .addTo(savedMap)
                });
            },
            error: function (jqXHR, textStatus, errorThrown) {
                console.log('failed');
                console.log(jqXHR);
                console.log(textStatus);
                console.log(errorThrown);
            }
        });
    }

    document.addEventListener("load", getLocations());

</script>

{% endblock %}

{% block white_content_block %}

<div class="card">
    {% for trip in upcomingList %}
        <h5 class="card-header"><strong>{{ trip.destination }}</strong></h5>
        <div class="card-body">
            <!-- <h5 class="card-title">{{ trip.destination }}</h5> -->
            <p class="card-text">
                <li>Trip starts: {{ trip.dateStart }}</li>
                <li>Trip ends: {{ trip.dateEnd }}</li>
                <li>Budget lower range: £{{ trip.budgetStart }}</li>
                <li>Budget higher range: £{{ trip.budgetEnd }}</li>
            </p>
        </div>
    {% endfor %}
</div>
{% endblock %}